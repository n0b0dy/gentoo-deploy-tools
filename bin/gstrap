#!/bin/sh
STAGE3_PATH=""
PORTAGE_PATH=""
EXTRACT_PATH="."

stage3_download(){
  mkdir -p $EXTRACT_PATH
  echo "Download stage3: "
  wget -O - $STAGE3_PATH | tar -C $EXTRACT_PATH -xpjf -
}

portage_download() {
  mkdir -p $EXTRACT_PATH"/usr"
  echo "Download portage: "
  wget -O - $PORTAGE_PATH | tar -C $EXTRACT_PATH"/usr" -xpjf -
}

usage_err(){
	info USAGE1 "usage: [OPTION]... <suite> <target> [<mirror> [<script>]]"
	info USAGE2 "Try \`${0##*/} -h' for more information."
	error "$@"
}

usage(){ 
	echo "Usage:
  ${0##*/} [options] extract path"
	cat <<EOF

Application Options:
  -s <name>    stage3
  -p <name>    portage list

Version: 0.4.1
Licence: GNU GPL version 3 <http://www.gnu.org/licenses/gpl.html>
EOF
}
 
if [ "$#" -eq 0 ]; then usage;exit 1;fi
ARGS=$(getopt -n ${0##*/} -o 'hns::p::a:m:' -- "$@")
eval set -- "$ARGS"
while [ "$1" != -- ]; do
    case "$1" in
        -p) PORTAGE_PATH=$2;shift;;
        -s) STAGE3_PATH=$2;shift;;
        -h) usage;exit 0;;
    esac
    shift
done

shift $(expr $# - 1) 
EXTRACT_PATH=$1
####################################################

EXTRACT_PATH=$(echo $EXTRACT_PATH | sed 's/\/$//')
####################################################
if [ -n "$STAGE3_PATH" ]; then
	stage3_download;
fi

if [ -n "$PORTAGE_PATH" ]; then
	portage_download;
fi
exit 0

